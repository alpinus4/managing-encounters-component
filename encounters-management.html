<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="./bower_components/moment/moment.js"></script>

<dom-module id="encounters-management">

  <template>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
      :host {
        width: 100%;
        height: 100%;
        display: var(--encounters-management-display , inline-block);
        font-size: var(--encounters-management-font-size , 20pt);
        color: var(--encounters-management-font-color , rgb(24, 24, 24));
        background-color: var(--encounters-management-background-color , inherit);
        padding: var(--encounters-management-padding , 20px);
      }

      :host #content {
        width: 100%;
        height: 100%;
      }

      /*HEADER*/
      :host .header {
        font-size: var(--encounters-management-font-size-header , 36pt);
        color: var(--encounters-management-font-color-header , rgb(62, 62, 62));
        margin-left: 5%;
      }


      /*INDEX*/
      :host .index {
        font-size: var(--encounters-management-font-size-index , inherit);
        color: var(--encounters-management-font-color-index , inherit);
      }


      /*TYPE*/
      :host .type {
        font-size: var(--encounters-management-font-size-type , inherit);
        color: var(--encounters-management-font-color-type , inherit);
      }


      /*LOCATION*/
      :host .location {
        font-size: var(--encounters-management-font-size-location , inherit);
        color: var(--encounters-management-font-color-location , inherit);
      }


      /*DATETIME*/
      :host .datetime {
        font-size: var(--encounters-management-font-size-datetime , inherit);
        color: var(--encounters-management-font-color-datetime , inherit);
      }

      /* TABLE*/
      :host .table-striped>tbody>tr:nth-child(odd)>td,
            .table-striped>tbody>tr:nth-child(odd)>th {
        background-color: rgb(255, 243, 228);
      }

      :host .white-table {
        background-color: rgb(255, 255, 255);
        box-shadow: 3px 10px 20px -3px rgba(97, 97, 97, 0.5);
      }


      /* SEARCH BAR*/
      :host #searchBar {
        border: none;
        box-shadow: 3px 10px 20px -3px rgba(97, 97, 97, 0.5);
        border-radius: 0;
        background: rgb(255, 255, 255);
        width: 40%;
        float: left;
      }

      :host #searchBarInput{
        min-height: 70px;
        border: none;
        box-shadow: none;
        width: 90%;
        float: left;
      }

      :host #searchBtn {
        float: right;
        width: 10%;
        height: 70px;
      }

      :host .my-btn-default {
        border: none;
        border-radius: 0;
        min-height: 70px;
        max-height: 70px;
        box-shadow: 3px 10px 20px -3px rgba(97, 97, 97, 0.5);
        vertical-align: middle;
        line-height: 70px;
        background: rgb(255, 255, 255);
        margin-left: 2%;
      }

      :host .my-btn-default:active, .my-btn-default:focus, .my-btn-default:hover{
        background: rgb(255, 255, 255);
      }

      :host #sortBtn {
        width: auto;
        margin-left: 5%;
      }

      :host #filtersBtn{
        width: auto;
        margin-left: 5%;
      }

      :host #filterInputToDate, #filterInputFromDate, #filterInputEncounterType{
        width: 20%;
      }

      :host #resultsParams {
        width: 50%;
        float: left;
      }

      :host #actions, #pagination {
        margin-top: 2%;
        margin-bottom: 3%;
      }

      :host #actions {
        float: left;
        width: 70%;
      }

      :host #pagination {
        float: right;
        width: 20%;
      }

      :host .pageBtn {
        width: 70px;
        height: 70px;
      }

      /*not to display*/
      :host .hidden {
        display: none;
      }

      :host .transparentBtn {
        border:none;
        background-color:transparent;
      }

      /* loading spinner */

      .loading-spinner {
        border: 6px solid #f3f3f3;
        border-radius: 50%;
        border-top: 6px solid #141414;
        width: 40px;
        height: 40px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(1080deg); }
      }


      /*MODAL From: https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_modal - BOOTSTRAP NOT WORKING*/
      .modal {
          display: none;
          position: fixed;
          z-index: 1;
          padding-top: 100px;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgb(0,0,0);
          background-color: rgba(0,0,0,0.4);
          font-size: 16pt;
      }

      .modal-content {
          background-color: #fefefe;
          margin: auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
      }

      .modal-content hr {
          border-width: 2px;
      }

      .modal-content button{
          font-size: 16pt;
      }


      .close-modal {
          color: #aaaaaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
      }

      .close-modal:hover,
      .close-modal:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
      }


    /* DROPDOWN from https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown
    Bootstrap not working*/

    .dropdown {
      display: inline-block;
      position: relative;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      overflow: auto;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .dropdown a:hover {background-color: #f1f1f1}

    .show {display:block;}

    .currentSortingSetting {
      transform: scale(1.2);
    }
    </style>

<div id="content">
      <!-- CREATE ENCOUNTER MODAL-->
      <div id="createEncounterModal" class="modal">

        <div class="modal-content">
          <span class="close-modal" on-click="CloseCreateModal">&times;</span>
          <h2>Create new encounter</h2>
          <hr></br>
          Patient name: <input type="text" class="form-control input-lg" id="createEncDataName"></input></br>
          Location: <input type="text" class="form-control input-lg" id="createEncDataLocation"></input></br>
          Encounter Date: <input type="text" class="form-control input-lg" id="createEncDataDate"></input></br>
          Encounter Type: <input type="text" class="form-control input-lg" id="createEncDataType"></input></br>
          Form: <input type="text" class="form-control input-lg" id="createEncDataForm"></input></br>
          Providers: <input type="text" class="form-control input-lg" id="createEncDataProviders"></input></br></br>
          <button type='button' class="btn btn-default" id="createEncounerBtn" on-click="CreateEncounter">
            Create
          </button>
        </div>
      </div>

      <!-- EDIT ENCOUNTER MODAL-->
      <div id="editEncounterModal" class="modal">

        <div class="modal-content">
          <span class="close-modal" on-click="CloseEditModal">&times;</span>
          <h2>Edit encounter</h2>
          <hr></br>
          Patient name: <input type="text" class="form-control input-lg" id="editEncDataName"></input></br>
          Location: <input type="text" class="form-control input-lg" id="editEncDataLocation"></input></br>
          Encounter Date: <input type="text" class="form-control input-lg" id="editEncDataDate"></input></br>
          Encounter Type: <input type="text" class="form-control input-lg" id="editEncDataType"></input></br>
          Form: <input type="text" class="form-control input-lg" id="editEncDataForm"></input></br>
          Providers: <input type="text" class="form-control input-lg" id="editEncDataProviders"></input></br></br>
          <button type='button' class="btn btn-default" id="editEncounerBtn" on-click="CreateEncounter">
            Save changes
          </button>
        </div>
      </div>

      <!-- FILTER MODAL-->
      <div id="filterModal" class="modal">

        <div class="modal-content">
          <span class="close-modal" on-click="CloseFilterModal">&times;</span>
          <h2>Filters</h2>
          <hr></br>
          <h3>Date range:</h3> </br>
          From: <input type="text" class="form-control input-lg" id="filterInputFromDate"></input>
          To: <input type="text" class="form-control input-lg" id="filterInputToDate"></input>
          </br>

          <h3>Encounter type:</h3> </br><input type="text" class="form-control input-lg" id="filterInputEncounterType"></input>
          </br>

          <button type='button' class="btn btn-default" id="editEncounerBtn" on-click="Filter">
            Filter
          </button>
        </div>
      </div>



      <div class="header">Encounters</div></br></br>
      <form id="searchForm" action="javascript:void(0);">
          <div id="searchBar">
            <input type="button" on-click="NewSearchQuery" id="changesq" name="changesq" class="hidden">
            <input type="text" class="form-control input-lg" id="searchBarInput" name="searchBarInput">
            <button type='submit' class="transparentBtn" id="searchBtn">
              <img src="./images/ic_search_black_48dp_2x.png" width="70px" height="70px">
            </button>
          </div>
      </form>
      <span class="glyphicons glyphicons-filter"></span>
      <div id="resultsParams">

          <button class="btn-default my-btn-default drp-btn" id="filtersBtn" on-click="FiltersModalShow">
            <img src="./images/ic_filter_list_black_48dp_2x.png" width="70px" height="70px"> Filters
          </button>

        <template is="dom-if" if="{{filters}}">
          <button class="btn-default my-btn-default drp-btn" id="clearFiltersBtn" on-click="ClearFilters">
            <img src="./images/ic_filter_list_black_48dp_2x.png" width="70px" height="70px"> Clear filters
          </button>
        </template>

      </div>
      <div id="actions">
        <button class="btn-default my-btn-default" on-click="OpenCreateModal">
          <img src="./images/ic_add_black_48dp_2x.png" width="30px" height="30px">  Create
        </button>
        <button class="btn-default my-btn-default" on-click="Import">
            <img src="./images/ic_file_upload_black_48dp_2x.png" width="30px" height="30px"> Import
        </button>
      </div>
      <div id="pagination">
        <span id="pageCount">1/5</span>
        <button class="btn-default pageBtn my-btn-default" on-click="PreviousPage">
            <img src="./images/ic_chevron_left_black_48dp_2x.png" width="30px" height="30px">
        </button>
        <button class="btn-default pageBtn my-btn-default" on-click="NextPage">
            <img src="./images/ic_chevron_right_black_48dp_2x.png" width="30px" height="30px">
        </button>
      </div>
      <table class="table table-striped white-table">
        <thead id="tableHeaders">
          <tr>
            <th><img src="./images/ic_settings_black_48dp_2x.png" width="30px" height="30px"></th>
            <th>Encounter date <button class="transparentBtn asc" value="encounterDatetime" on-click="ClickedSort">
                <img src="./images/sort1.png" width="30px" height="30px">
              </button></th>

            <th>Encounter type <button class="transparentBtn asc" value="encounterType" on-click="ClickedSort">
              <img src="./images/sort1.png" width="30px" height="30px">
            </button></th>

            <th>Form <button class="transparentBtn asc" value="form" on-click="ClickedSort">
              <img src="./images/sort1.png" width="30px" height="30px">
            </button></th>

            <th>Provider <button class="transparentBtn asc" value="location" on-click="ClickedSort">
              <img src="./images/sort1.png" width="30px" height="30px">
            </button></th>

            <th>Location <button class="transparentBtn asc" value="provider" on-click="ClickedSort">
              <img src="./images/sort1.png" width="30px" height="30px">
            </button></th>
          </tr>
        </thead>
        <tbody>
          <template is="dom-repeat" items="[[encountersToDisplay]]">
            <tr>
              <td>
                <button class="btn btn-default" on-click="OpenEditModal" value="{{item.uuid}}">
                  <img src="./images/ic_edit_black_48dp_2x.png" width="20px" height="20px">
                </button>
                <button class="btn btn-danger" on-click="OpenEditModal" value="{{item.uuid}}">
                  <img src="./images/ic_delete_forever_white_48dp_2x.png" width="20px" height="20px">
                </button>
              </td>
              <td class="datetime">{{item.encounterDatetime}}</td>
              <td class="type">{{item.encounterType.display}}</td>
              <td class="form">{{item.form.display}}</td>
              <td class="providers">
                <template is="dom-repeat" items="[[item.encounterProviders]]">
                {{item.provider.display}} &nbsp;
                </template>
  </td>
  <td class="location">{{item.location.display}}</td>
  </tr>
  </template>

  <template is="dom-if" if="{{notFound}}">
            <tr>
              <td colspan="7" align="center"></br>Not found any matching encounters.</td>
            </tr>
          </template>

  <template is="dom-if" if="{{loading}}">
            <tr>
            </br>
              <td colspan="7" align="center"><div class="loading-spinner"></div></td>
            </tr>
          </template>

  </tbody>
  </table>
  </div>


  <iron-ajax url="http://localhost:8080/lh-toolkit/ws/rest/v1/encounter"
  params='{{searchQueryObj}}'
  content-type="application/json"
  handle-as="json"
  with-credentials="true"
  on-response="handleResponseGetAll"
  method="GET"
  on-error="_error"
  id="iron_ajax_get_all"></iron-ajax>

  <iron-ajax url="http://localhost:8080/lh-toolkit/ws/rest/v1/encounter"
  params='{{newEncounterObj}}'
  content-type="application/json"
   handle-as="json"
   with-credentials="true"
   on-response="handleResponseCreateNew"
   method="POST"
   on-error="_error"
   id="iron_ajax_create"></iron-ajax>

  <iron-ajax url="{{deleteEditURL}}" with-credentials="true" content-type="application/json" method="DELETE" on-error="_error" id="iron_ajax_delete"></iron-ajax>

  <iron-ajax url="http://localhost:8080/lh-toolkit/ws/rest/v1/encounter" params='{{sqObj}}' content-type="application/json" handle-as="json" with-credentials="true" on-response="handleResponse" method="GET" on-error="_error" id="iron_ajax_edit"></iron-ajax>

  </template>

  <script>
    class EncountersManagement extends Polymer.Element {
      static get is() {
        return 'encounters-management';
      }
      static get properties() {
        return {
          encountersRaw: {
            type: Array,
            notice: true
          },
          encounters: {
            type: Array,
            notice: true
          },
          encountersToDisplay: {
            type: Array,
            notice: true
          },
          searchQuery: {
            type: String,
            observer: "_changedSearchQuery",
            notice: true
          },
          searchQueryObj: {
            type: Object
          },
          newEncounterObj: {
            type: Object
          },
          notFound: {
            type: Boolean
          },
          loading: {
            type: Boolean
          },
          pageNmb: {
            type: Number
          },
          numberRecordsPerPage: {
            type: Number
          },
          deleteEditURL: {
            type: String
          },
          filters: {
            type: Boolean
          }
        }
      }

      constructor() {
        super();
        this.numberRecordsPerPage = 8;
      }

      ready() {
        super.ready();

        //SEARCH
        this.$.searchForm.addEventListener('submit', function(evt) {
          this.changesq.click();
        });

        //DROPDOWN
        this.$.content.addEventListener('click', function(evt) {
          if (!evt.target.matches('.drp-btn')) {
            var dropdowns = this.querySelectorAll('.dropdown-content');
            for (var i = 0; i < dropdowns.length; i++) {
              if (dropdowns[i].classList.contains('show')) {
                dropdowns[i].classList.remove('show');
              }
            }
          }
        });

      }

/////////DELETE//////////////
      DeleteItem(e) {
        console.log(e.target.value);
        this.deleteEditURL = "http://localhost:8080/lh-toolkit/ws/rest/v1/encounter/" + e.target.value;
        console.log(this.deleteEditURL);
        console.log(this.$.iron_ajax_delete.url);
        this.$.iron_ajax_delete.generateRequest();
        this._changedSearchQuery();
      }

/////////IMPORT//////////////
      Import() {
        console.log("import");
      }

/////////SEARCH//////////////
      _changedSearchQuery() {
        this.searchQueryObj = {
          q: this.searchQuery,
          v: "full"
        }
        this.$.iron_ajax_get_all.generateRequest();
        this.loading = true;
        this.encounters = [];
        this.notFound = false;
      }

      NewSearchQuery(e) {
        this.searchQuery = this.$.searchBarInput.value;
      }

      handleResponseGetAll(data) {
        this.pageNmb = 0;
        var encounters = data.detail.response.results;
        this.encountersRaw = data.detail.response.results;

        if (encounters.length == 0) {

          this.notFound = true;
          this.encountersToDisplay = [];

        } else {
          //parse dates and correct data
          for (var i = 0; i < encounters.length; i++) {
            encounters[i].encounterDatetime = parseDate(encounters[i].encounterDatetime);
            encounters[i].encounterType.display = encounters[i].encounterType.display.toLowerCase();
            encounters[i].encounterType.display = capitalizeFirstLetter(encounters[i].encounterType.display);
            encounters[i].patient.display = encounters[i].patient.display.replace(/[^a-zA-Z]+/g, ' '); //Get only name without id

            for (var x = 0; x < encounters[i].encounterProviders.length; x++) {
              encounters[i].encounterProviders[x].provider.display =
                encounters[i].encounterProviders[x].provider.display.replace(/[^a-zA-Z]+/g, ' '); //Get only name without id
            }

          }
          this.encountersToDisplay = this.PushPage(encounters);
        }
        this.encounters = encounters;
        this.loading = false;
        this.UpdatePagination();
      }


/////////EDIT//////////////
      OpenEditModal(e) {
        this.$.editEncounterModal.style.display = "block";

        //Set values to edit
        var encounterToEdit = this.GetMatchingEncounter(e.target.value);
        this.$.editEncDataDate.value = encounterToEdit.encounterDatetime;
        this.$.editEncDataName.value = encounterToEdit.patient.display;
        this.$.editEncDataForm.value = encounterToEdit.form.display;
        this.$.editEncDataType.value = encounterToEdit.encounterType.display;
        this.$.editEncDataLocation.value = encounterToEdit.location.display;
        this.$.editEncDataProviders.value = encounterToEdit.encounterProviders[0].provider.display;
      }

      CloseEditModal() {
        this.$.editEncounterModal.style.display = "none";
      }

      GetMatchingEncounter(encounteruuid) {
        for (var i = 0; i < this.encountersToDisplay.length; i++) {
          if (this.encountersToDisplay[i].uuid == encounteruuid) {
            return this.encountersToDisplay[i];
          }
        }
      }


/////////SORT//////////////
      Sort(key, asc = true) {
        var simpleArrayToSort = [];

        for (var i = 0; i < this.encounters.length; i++) {
          var date = new Date(parseDateReturnDate(this.encounters[i].encounterDatetime));

          var ObjToPush = {
            uuid: this.encounters[i].uuid,
            encounterDatetime: date,
            encounterType: this.encounters[i].encounterType.display,
            form: this.encounters[i].form.display,
            location: this.encounters[i].location.display,
            provider: this.encounters[i].encounterProviders[0].provider.display
          };
          simpleArrayToSort.push(ObjToPush);
        }
        var simple_sorted = sortByKey(simpleArrayToSort, key, asc);

        var sorted_full = [];
        for (var i = 0; i < simple_sorted.length; i++) {
          for (var x = 0; x < this.encounters.length; x++) {
            if (simple_sorted[i].uuid == this.encounters[x].uuid) {
              sorted_full.push(this.encounters[x]);
            }
          }
        }

        this.encounters = sorted_full;
        this.RefreshRecords();
      }

      ClickedSort(e) {
        var sortBtns = this.$.tableHeaders.querySelectorAll(".transparentBtn");
        for (var i = 0; i < sortBtns.length; i++) {
          if (sortBtns[i].classList.contains('currentSortingSetting')) {
            sortBtns[i].classList.remove('currentSortingSetting');
          }
        }

        var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);

        if(!isChrome) {
          e.target.classList.toggle("asc");
          if (e.target.classList.contains("asc")) {
            this.Sort(e.target.value);
            e.target.querySelector("img").src = "./images/sort1.png";
            e.target.classList.add("currentSortingSetting");
          } else {
            this.Sort(e.target.value, false);
            e.target.querySelector("img").src = "./images/sort2.png";
            e.target.classList.add("currentSortingSetting");
          }
        }else{
          e.target.parentNode.classList.toggle("asc");
          if (e.target.parentNode.classList.contains("asc")) {
            this.Sort(e.target.parentNode.value);
            e.target.src = "./images/sort1.png";
            e.target.parentNode.classList.add("currentSortingSetting");
          } else {
            this.Sort(e.target.parentNode.value, false);
            e.target.src = "./images/sort2.png";
            e.target.parentNode.classList.add("currentSortingSetting");
          }
        }
      }

/////////FILTER//////////////
      Filter() {
        this.CloseFilterModal();
        if(this.$.filterInputFromDate.value != "" || this.$.filterInputToDate.value != ""
              || this.$.filterInputEncounterType.value != ""){

          this.filters = true;
        }else{
          this.filters = false;
        }
        this.RefreshRecords();
      }

      ClearFilters(){
        this.filters = false;
        this.$.filterInputFromDate.value = "";
        this.$.filterInputToDate.value = "";
        this.$.filterInputEncounterType.value = "";
        this.RefreshRecords();
      }


      FiltersModalShow() {
        this.$.filterModal.style.display = "block";
      }

      CloseFilterModal() {
        this.$.filterModal.style.display = "none";
      }

      FilterEncounter(encounter){
        var decision = true;
        var fromDate = new Date(this.$.filterInputFromDate.value);
        var toDate = new Date(this.$.filterInputToDate.value);
        var encounterDate = new Date(encounter.encounterDatetime);
        var type = this.$.filterInputEncounterType.value.toLowerCase();
        var encounterType = encounter.encounterType.display.toLowerCase();

        if(fromDate != "" || toDate != "" ){
          if(encounterDate < fromDate || encounterDate > toDate){
            decision = false;
          }
        }

        if(type != ""){
          if(type != encounterType){
            decision = false;
          }
        }
        return decision;
      }

/////////CREATE NEW//////////////
      OpenCreateModal() {
        this.$.createEncounterModal.style.display = "block";
      }
      CloseCreateModal() {
        this.$.createEncounterModal.style.display = "none";
      }
      CreateEncounter() {
        this.newEncounterObj = {
          "resource": {
            "form": "bab74758-c679-11e6-b56b-f81654da705a",
            "patient": "1144f49d-f6c9-44b1-bd53-9574a2894883",
            "location": "8d6c993e-c2cc-11de-8d13-0010c6dffd0f",
            "encounterDatetime": "2018-01-13T17:28:54+00:00",
            "encounterType": "8d5b27bc-c2cc-11de-8d13-0010c6dffd0f"
          }
        };
        console.log(this.encounters);
        console.log("Generate req");
        this.$.iron_ajax_create.generateRequest();
      }

      handleResponseCreateNew(data) {
        console.log(data.detail.response);
      }


/////////PAGINATION//////////////
      PushPage(encounters) {
        var maxIndx = (this.pageNmb + 1) * (this.numberRecordsPerPage - 1);
        if (this.pageNmb != 0) {
          var minIndx = this.pageNmb * (this.numberRecordsPerPage - 1) + 1;
        } else {
          var minIndx = 0;
        }

        var encountersToReturn = [];

        for (var i = minIndx; i < (maxIndx + 1); i++) {
          if (encounters[i]) {
            if(this.filters){
              console.log("PushPageIfFilters");
              var toPush = this.FilterEncounter(encounters[i]);
              console.log(encounters[i]);
              console.log(toPush);
              if(toPush){
                encountersToReturn.push(encounters[i]);
              }
            }else{
              encountersToReturn.push(encounters[i]);
            }
          }
        }
        return encountersToReturn;
      }

      RefreshRecords(){
        this.encountersToDisplay = this.PushPage(this.encounters);
      }

      PreviousPage() {
        this.pageNmb--;
        this.pageNmb = Math.max(0, Math.min(Math.floor(this.encounters.length / this.numberRecordsPerPage), this.pageNmb)); //clamp
        this.RefreshRecords();
        this.UpdatePagination();
      }

      NextPage() {
        this.pageNmb++;
        this.pageNmb = Math.max(0, Math.min(Math.floor(this.encounters.length / this.numberRecordsPerPage), this.pageNmb)); //clamp
        this.RefreshRecords();
        this.UpdatePagination();
      }

      UpdatePagination() {
        var pageNumber = this.pageNmb + 1;
        this.$.pageCount.innerHTML = pageNumber + "/" + (Math.floor(this.encounters.length / this.numberRecordsPerPage) + 1);
      }


/////////ERROR//////////////
      _error(event) {
        console.log("Event:");
        console.log(event);
        console.log("");
        console.log("Event Detail:");
        console.log(event.detail);
        console.log("");
        console.log("Event Detail Error");
        console.log(event.detail.error);
        console.log("");
        console.log("Error Message");
        console.log(event.detail.error.message);
        console.log("");
        console.log("Request");
        console.log(event.detail.request);
        console.log("");
        console.log("Response");
        console.log(event.detail.response);
        console.log("");
        console.log("Request Response");
        console.log(event.detail.request.response);
        console.log("");
        console.log("");
      }

    }
    customElements.define(EncountersManagement.is, EncountersManagement);
  </script>

  <script>
    function parseDate(givenDate) {
      var date = new Date(givenDate);

      //part of code from https://stackoverflow.com/questions/3605214/javascript-add-leading-zeroes-to-date with added hours and minutes
      var myDateString;
      date.setDate(date.getDate() + 0);
      myDateString = ('0' + date.getDate()).slice(-2) + '/' +
        ('0' + (date.getMonth() + 1)).slice(-2) + '/' +
        date.getFullYear() + '  ' +
        ('0' + (date.getHours() - 1)).slice(-2) + ':' +
        ('0' + date.getMinutes()).slice(-2);

      return myDateString;
    }

    function parseDateReturnDate(givenDate) {
      var date = moment(givenDate, "DD/MM/YYYY HH:mm").format("MM/DD/YYYY HH:mm");
      return date;
    }

    //part of code from https://stackoverflow.com/questions/1026069/how-do-i-make-the-first-letter-of-a-string-uppercase-in-javascript
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    //part of code from https://stackoverflow.com/questions/8175093/simple-function-to-sort-an-array-of-objects modified by me
    function sortByKey(array, key, asc) {
      return array.sort(function(a, b) {
        var x = a[key];
        var y = b[key];
        if (asc) {
          return ((x < y) ? -1 : ((x > y) ? 1 : 0));
        } else {
          return ((x < y) ? 1 : ((x > y) ? -1 : 0));
        }
      });
    }
  </script>

</dom-module>
